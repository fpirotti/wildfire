"0",""
"0","library(knitr) "
"0",""
"0","library(kableExtra)"
"0","library(terra)"
"0","library(Metrics)"
"0","library(gt)"
"0","library(tidyverse)"
"0","library(yardstick)"
"0",""
"0","todos <- list("
"0","""CZ-AT"" = list(  pred = terra::rast(""input/CZ-AT_ScottBurganFuelMapClassV2.tif"") ,"
"0","                obs = terra::rast(""data/validation/WildfireCE_Fuel_map_validation_AT-CZ_CzechGlobe_model.tif"") "
"0","            ),"
"0",""
"0","""DE-CZ"" = list(pred = terra::rast(""input/DE-CZ_ScottBurganFuelMapClassV2.tif""),"
"0","               obs = terra::rast(""data/validation/WildfireCE_Fuel_map_validation_DE-CZ_CzechGlobe_model.tif"")"
"0"," )"
"0",")"
"0",""
"0","risultati <- list()"
"0","for(area in names(todos) ){"
"0","  pred <- todos[[area]][[""pred""]]"
"0","  ref <- todos[[area]][[""obs""]]"
"0","  cls<-terra::resample( terra::project(pred, ref, method=""near""), ref, method=""near"" )"
"0",""
"0","  cls[cls==0] <- NA"
"0","  ref[ref==0] <- NA"
"0","  "
"0","  s <- c(ref, cls)"
"0","  "
"0","    # terra::writeRaster(s,"
"0","    #                  sprintf(""input/%s_ScottBurganFuelMapClassV2_32633.tif"","
"0","    #                          area), overwrite=T )"
"0","    "
"0","  # plot(s)"
"0","  # Extract values as a data.frame"
"0","  vals <- na.omit(as.data.frame(s, xy=FALSE))"
"0","  colnames(vals) <- c(""CzechGlobe"", ""WildFire"")"
"0","  "
"0","  lvs <- sort(unique(c(vals$WildFire, vals$CzechGlobe)))"
"0","  "
"0","  vals$WildFire <- factor(vals$WildFire, levels = lvs)"
"0","  vals$CzechGlobe <-  factor(vals$CzechGlobe, levels = lvs) "
"0","  "
"0","  conf_mat <- table(vals$CzechGlobe, vals$WildFire)"
"0","  # Overall accuracy"
"0","  overall_acc <- sum(diag(conf_mat)) / sum(conf_mat) "
"0","  # Producer's accuracy (per class)"
"0","  prod_acc <- diag(conf_mat) / rowSums(conf_mat) "
"0","  # User's accuracy (per class)"
"0","  user_acc <- diag(conf_mat) / colSums(conf_mat) "
"0","  # Kappa"
"0","  pe <- sum(rowSums(conf_mat) * colSums(conf_mat)) / (sum(conf_mat)^2)"
"0","  kappa <- (overall_acc - pe) / (1 - pe)"
"0","  "
"0","  cm_ext <-  as.matrix(conf_mat)"
"0","  cm_ext <- cbind(cm_ext, ""Prod.Acc"" = sprintf(""%.1f%%"", prod_acc*100)) "
"0","  # Add User’s Accuracy as extra row"
"0","  cm_ext <- rbind(cm_ext, ""User.Acc"" = c(sprintf(""%.1f%%"", user_acc*100), "
"0","                                         sprintf(""%.1f%%"", overall_acc*100)))"
"0","  "
"0","  "
"0","  k <- kable(cm_ext, caption = paste0(""--"", area, "" - Confusion Matrix ALL rows=CzechGlobe (reference)   colums=Wildfire-V2 (Classified)   kappa="", round(kappa,3)) ) %>%"
"0","  kable_styling(latex_options = c(""scale_down"", ""hold_position""),full_width = FALSE, font_size =9) %>%"
"0","  scroll_box(width = ""100%"", height = ""300px"")  "
"0",""
"0",""
"0","print(k)"
"0","cat(""\\newpage\n"")   "
"0",""
"0","  vals$CzechGlobe2 <-  trunc(as.integer(as.character(vals$CzechGlobe))/10) "
"0","  vals$WildFire2 <- trunc(as.integer(as.character(vals$WildFire))/10)  "
"0","  lvs <- sort(unique(c(vals$WildFire2, vals$CzechGlobe2)))"
"0","  "
"0","  vals$WildFire2 <- factor(vals$WildFire2, levels = lvs)"
"0","  vals$CzechGlobe2 <-  factor(vals$CzechGlobe2, levels = lvs) "
"0","  "
"0","  # ids <- rownames(vals)[ vals$WildFire2==vals$CzechGlobe2 ]"
"0","  # errors <- s"
"0","  # errors[ as.integer(ids) ]<- NA"
"0","  # plot(errors)"
"0","  # discrepancies <- na.omit(as.points(errors))"
"0","  # writeVector(discrepancies, sprintf(""%s_discrepancies.gpkg"", area), overwrite=TRUE)"
"0","  conf_mat2 <- table(Reference = vals$CzechGlobe2, Classified=vals$WildFire2)"
"0","  # Overall accuracy"
"0","  overall_acc2 <- sum(diag(conf_mat2)) / sum(conf_mat2) "
"0","  # Producer's accuracy (per class)"
"0","  prod_acc2 <- diag(conf_mat2) / rowSums(conf_mat2) "
"0","  # User's accuracy (per class)"
"0","  user_acc2 <- diag(conf_mat2) / colSums(conf_mat2) "
"0","  # Kappa"
"0","  pe2 <- sum(rowSums(conf_mat2) * colSums(conf_mat2)) / (sum(conf_mat2)^2)"
"0","  kappa2 <- (overall_acc2 - pe2) / (1 - pe2)"
"0",""
"0","  cm_ext <-  as.matrix(conf_mat2)"
"0","  cm_ext <- cbind(cm_ext, ""Prod.Acc"" = sprintf(""%.1f%%"", prod_acc2*100)) "
"0","  # Add User’s Accuracy as extra row"
"0","  cm_ext <- rbind(cm_ext, ""User.Acc"" = c(sprintf(""%.1f%%"", user_acc2*100), "
"0","                                         sprintf(""%.1f%%"", overall_acc2*100)))"
"0",""
"0","  "
"0","k <- kable(cm_ext, align = ""r"", caption = paste0(""--"", area, "" - Confusion Matrix rows=CzechGlobe (reference)   colums=Wildfire-V2 (Classified)   kappa="", round(kappa2,3)) ) %>%"
"0","  kable_styling(full_width = FALSE, latex_options = c(""hold_position"", ""striped"", ""scale_down"")) %>%"
"0","  column_spec(1, bold = TRUE) "
"0",""
"0",""
"0","print(k)"
"0","cat(""\\newpage\n"")  "
"0","}"
